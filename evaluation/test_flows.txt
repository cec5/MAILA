Flow 1: The Standard Email Task (Start to Finish)
Goal: Test the primary "happy path" functionality of the email transaction module.

1.  User: start a new session
2.  Maila: (Should create a session, provide email/SID, and return to 'normal' state)
3.  (External): Send 3 test emails (e.g., "Test 1," "Test 2," "Test 3") to the new email address.
4.  User: check my inbox
5.  Maila: (Should list all 3 emails and enter 'email_manage_loop' state)
6.  User: view email 2
7.  Maila: (Should confirm and launch the EmailViewer window for "Test 2")
8.  User: download email 1
9.  Maila: (Should confirm the download. File should appear in downloads/[sessionID] folder)
10. User: delete emails 1 and 3
11. Maila: (Should confirm 2 emails were deleted)
12. User: list emails
13. Maila: (Should list only one email: "1. ... Subject: Test 2")
14. User: end session
15. Maila: (Should ask for explicit confirmation)
16. User: yes
17. Maila: (Should confirm the session is ended and return to 'normal' state)

--------------------------------------------------

Flow 2: The Interrupted User (Context Switching)
Goal: Test the chat_stack's ability to handle nested tasks and interruptions.

1.  User: help me
2.  Maila: (Should enter 'general_help_loop' state and ask what the user needs help with)
3.  User: tell me about your capabilities
4.  Maila: (Should enter 'capabilities_help' state and list features)
5.  User: wait, my name is Chris
6.  Maila: (Should immediately handle the identity intent, confirm the name change, and update the GUI)
7.  User: where am i
8.  Maila: (Should respond that the state is 'capabilities_help')
9.  User: what about small talk?
10. Maila: (Should provide the detailed explanation for small talk)
11. User: thanks, cancel
12. Maila: (Should pop all discoverability states and return to 'normal' state)
13. User: where am i
14. Maila: (Should respond that the state is 'normal')
15. User: who am i?
16. Maila: (Should respond, "You are Chris")

--------------------------------------------------

Flow 3: The Confused User (Prompts & Universal Commands)
Goal: Test clarification prompts, error handling, and universal commands.

1.  User: start a new session
2.  Maila: (Provides email/SID and returns to 'normal' state)
3.  (External): Send 3 test emails to the address.
4.  User: check inbox
5.  Maila: (Lists the 3 emails and enters 'email_manage_loop' state)
6.  User: delete
7.  Maila: (Should ask for clarification: "Which email(s)...?" and enter 'awaiting_delete_index' state)
8.  User: what now?
9.  Maila: (Should provide guidance specific to the 'awaiting_delete_index' state)
10. User: actually, download
11. Maila: (Should not understand; should re-prompt for a delete index)
12. User: go back
13. Maila: (Should pop 'awaiting_delete_index' state and return to 'email_manage_loop')
14. User: delete all
15. Maila: (Should ask for explicit confirmation and enter 'awaiting_delete_all_confirm')
16. User: no
17. Maila: (Should cancel the deletion and return to 'email_manage_loop')
18. User: cancel
19. Maila: (Should cancel the entire email task and return to 'normal' state)

--------------------------------------------------

Flow 4: The Returning User (Session Management)
Goal: Test handling queries without a session and successfully restoring a session.

1.  User: list my emails
2.  Maila: (Should respond "no active session" and ask to create one, entering 'awaiting_session_start_confirm')
3.  User: no
4.  Maila: (Should cancel and return to 'normal')
5.  User: I need to restore a session
6.  Maila: (Should ask for the Session ID, entering 'awaiting_session_restore')
7.  User: my id is 12345
8.  Maila: (Should fail to extract a valid 24-char ID and re-prompt)
9.  User: oh, what is my name?
10. Maila: (Should interrupt to handle identity; e.g., "I don't have a name for you...")
11. User: no
12. Maila: (Should cancel the name task and return to 'awaiting_session_restore' state)
13. (External): Manually get a valid [SESSION_ID] from a previous session that had 3 emails.
14. User: restore my session [SESSION_ID]
15. Maila: (Should successfully restore the session, state the email address, and return to 'normal')
16. User: manage my inbox
17. Maila: (Should enter 'email_manage_loop')
18. User: list emails
19. Maila: (Should successfully fetch and list the 3 emails from the restored session)

--------------------------------------------------

Flow 5: Identity, Prompts, and 'repeat' Command
Goal: Test the identity flow from an unknown state and the 'repeat' command.

1.  User: who am i?
2.  Maila: (Should respond "I don't have a name..." and ask to set one, entering 'awaiting_name_confirm')
3.  User: repeat
4.  Maila: (Should repeat the prompt: "I don't have a name... Would you like to tell me what to call you?")
5.  User: yes
6.  Maila: (Should ask for the name, entering 'awaiting_name')
7.  User: Sarah
8.  Maila: (Should confirm the name: "Pleased to meet you, Sarah!" and return to 'normal')
9.  User: check my email
10. Maila: (Should respond "no active session" and ask to create one, entering 'awaiting_session_start_confirm')
11. User: no
12. Maila: (Should cancel and return to 'normal')
13. User: who am i?
14. Maila: (Should respond, "You are Sarah")

--------------------------------------------------

Flow 6: Non-Transactional Interruptions (Q&A, Small Talk)
Goal: Test Maila's ability to handle Q&A and Small Talk during an active email session.

1.  User: start a new session
2.  Maila: (Provides email/SID and returns to 'normal' state)
3.  (External): Send 3 test emails to the address.
4.  User: check inbox
5.  Maila: (Lists the 3 emails and enters 'email_manage_loop' state)
6.  User: what is the capital of France?
7.  Maila: (Should answer the Q&A question: "The capital of France is Paris.")
8.  User: where am i
9.  Maila: (Should respond that the state is 'email_manage_loop')
10. User: how are you?
11. Maila: (Should respond to the Small Talk, e.g., "I'm doing well...")
12. User: where am i
13. Maila: (Should respond that the state is 'email_manage_loop')
14. User: view email 1
15. Maila: (Should successfully open the email viewer for email 1)
16. User: cancel
17. Maila: (Should cancel the email task and return to 'normal' state)

--------------------------------------------------

Flow 7: Invalid Index and State Mismatch
Goal: Test Maila's error handling for invalid inputs and actions on non-existent data.

1.  User: start a new session
2.  Maila: (Provides email/SID and returns to 'normal' state)
3.  (External): Send 3 test emails to the address.
4.  User: check inbox
5.  Maila: (Lists the 3 emails and enters 'email_manage_loop' state)
6.  User: delete emails 1, 3
7.  Maila: (Should confirm deletion of 2 emails)
8.  User: list emails
9.  Maila: (Should list one email, indexed as "1. ...")
10. User: view email 2
11. Maila: (Should fail. The only valid index is now '1'. This enters 'awaiting_view_index')
12. User: 2
13. Maila: (Should respond with an error, e.g., "Index 2 is out of bounds (1-1)")
14. User: go back
15. Maila: (Should return to 'email_manage_loop')
16. User: delete
17. Maila: (Should enter 'awaiting_delete_index')
18. User: view email 1
19. Maila: (Should *not* view the email. It's in a 'delete' state. It should respond that it didn't understand the index)
20. User: cancel
21. Maila: (Should cancel the email task and return to 'normal')

--------------------------------------------------

Flow 8: Deep Stack Interruption and 'go back'
Goal: Test the integrity of the LIFO chat_stack with multiple nested interruptions.

1.  User: start a new session
2.  Maila: (Provides email/SID and returns to 'normal' state. Stack: ['normal'])
3.  User: delete
4.  Maila: (Enters 'awaiting_delete_index'. Stack is ['normal', 'awaiting_delete_index'])
5.  User: help
6.  Maila: (Enters 'general_help_loop'. Stack is ['normal', 'awaiting_delete_index', 'general_help_loop'])
7.  User: change my name
8.  Maila: (Enters 'awaiting_name'. Stack is [..., 'general_help_loop', 'awaiting_name'])
9.  User: go back
10. Maila: (Should pop 'awaiting_name' and return to 'general_help_loop')
11. User: where am i
12. Maila: (Should respond 'general_help_loop')
13. User: change my name
14. Maila: (Enters 'awaiting_name' again)
15. User: Tester
16. Maila: (Should confirm the name "Tester" and pop 'awaiting_name', returning to 'general_help_loop')
17. User: who am i?
18. Maila: (Should respond "You are Tester")
19. User: where am i
20. Maila: (Should respond 'general_help_loop')
21. User: cancel
22. Maila: (Should pop all 'discoverability' states, returning to 'awaiting_delete_index')
23. User: where am i
24. Maila: (Should respond 'awaiting_delete_index')
25. User: cancel
26. Maila: (Should pop all 'email' states, returning to 'normal')
27. User: where am i
28. Maila: (Should respond 'normal')
29. User: who am i?
30. Maila: (Should respond "You are Tester")

--------------------------------------------------

Flow 9: Ambiguous Wording and Confirmation
Goal: Test the classifier's ability to handle synonyms and the confirmation state's strictness.

1.  User: I need a new email
2.  Maila: (Should interpret as 'start_session', provide email/SID, and return to 'normal' state)
3.  (External): Send 3 test emails to the address.
4.  User: show me what I've got
5.  Maila: (Should interpret as 'list_emails', list the 3 emails, and enter 'email_manage_loop' state)
6.  User: I want to read number 3
7.  Maila: (Should interpret as 'view_email' and open the EmailViewer for email 3)
8.  User: get rid of number 1
9.  Maila: (Should interpret as 'delete_email' and delete email 1)
10. User: I want to trash everything
11. Maila: (Should interpret as 'delete_email' with 'all', ask for confirmation, and enter 'awaiting_delete_all_confirm')
12. User: I guess so
13. Maila: (Should interpret this as "no" since it's not an explicit "yes". It should cancel the deletion and return to 'email_manage_loop')
14. User: list emails
15. Maila: (Should list the remaining 2 emails)
16. User: I'm done
17. Maila: (Should interpret as 'end_session', ask for confirmation, and enter 'awaiting_session_end_confirm')
18. User: correct
19. Maila: (Should interpret as "yes", end the session, and return to 'normal')

--------------------------------------------------

Flow 10: Vague States and Non-Command Navigation
Goal: Test how states handle vague user replies and non-standard exit phrases.

1.  User: what can you do?
2.  Maila: (Should interpret as 'Capabilities', enter 'capabilities_help', and list features to explain)
3.  User: tell me about the last one
4.  Maila: (Should not understand "the last one" and re-prompt for a valid capability, e.g., "email", "small talk", etc.)
5.  User: nevermind, i'm done with this
6.  Maila: (Should interpret this as "no" or "nevermind", exit the discoverability loop, and return to 'normal')
7.  User: what's my status?
8.  Maila: (Should interpret as 'where am i' and respond 'normal')
9.  User: do you know who i am?
10. Maila: (Should interpret as 'Identification', respond "I don't have a name...", and enter 'awaiting_name_confirm')
11. User: I'd rather not
12. Maila: (Should interpret as "no", cancel the name task, and return to 'normal')
13. User: I need to see an email
14. Maila: (Should interpret as an 'Email' intent, respond "no active session", and enter 'awaiting_session_start_confirm')
15. User: what's going on?
16. Maila: (Should interpret as 'where am i' and respond 'awaiting_session_start_confirm')
